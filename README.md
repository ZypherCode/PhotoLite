## **Техническое задание проекта "PhotoLite**
_Автор - Дронов Мирослав_

### 1. Описание

**PhotoLite** - редактор растровой графики, использующий слои.
Программа позволяет пользователю создавать, редактировать и сохранять проекты в собственном формате `.pld`, который представляет собой архив, включающий базу данных SQLite и изображения каждого слоя.

Редактор поддерживает основные функции рисования: кисть с регулируемым размером и типом, работу со слоями (создание, удаление, скрытие, блокировка), наложение текста и сохранением в файл.


### 2. Используемые модули

| Модуль              | Назначение                                              |
| ------------------- | ------------------------------------------------------- |
| **PyQt6.QtWidgets** | Интерфейс: сцена, элементы, диалоги                     |
| **PyQt6.QtGui**     | Работа с QPixmap, QPainter, QBrush, QPen, QGradient     |
| **PyQt6.QtCore**    | Основные классы Qt: QPoint, QSize, QRectF, Qt           |
| **sqlite3**         | Хранение данных проекта и параметров слоёв              |
| **zipfile**         | Архивация проекта в формат `.pld`                       |
| **os / psutil**     | Работа с файловой системой при сохранении и открытии    |
| **math**            | Геометрия при рисовании (вычисление расстояния и шагов) |


### 3. Функционал

#### **Файл**

* Создание нового проекта (ввод имени, размера холста, фонового цвета).
* Открытие существующего проекта `.pld`.
* Сохранение проекта `.pld` (создание архива с БД и изображениями слоёв).
* Экспорт в `.png` - объединение всех видимых слоёв в одно изображение.

#### **Слои**

* Создание, переименование и удаление слоёв.
* Изменение порядка слоёв (перемещение вверх/вниз).
* Установка прозрачности, видимости и блокировки.
* Поддержка трёх типов слоёв:

  1. **Solid** - однотонный слой с цветом фона.
  2. **Image** - растровое изображение (пригодно для рисования).
  3. **Text** - текстовый слой с изменяемым шрифтом, цветом и содержимым.

#### **Рисование**

* Инструмент "кисть":

  * Размер (в пикселях).
  * Тип (мягкая, жёсткая, текстурная).
  * Цвет RGB.
* Инструмент "ластик" - работает как кисть, но не рисует, а удаляет пиксели на активном слое.
* Отображение круга на месте курсора для визуализации размера кисти.

#### **Редактирование и навигация**

* Нижняя панель показывает количество памяти и процессора, которое использует программа.
* Масштабирование сцены (зум).
* Панель параметров текущего слоя и кисти.


### 4. Архитектура базы данных

База данных SQLite создаётся при сохранении проекта и хранится внутри архива `.pld`.
Она описывает параметры документа и все слои.

#### **Таблица `project`**

| Поле               | Тип                 | Описание                        |
| ------------------ | ------------------- | ------------------------------- |
| `id`               | INTEGER PRIMARY KEY | ID проекта                      |
| `name`             | TEXT                | Название проекта                |
| `width`            | INTEGER             | Ширина холста                   |
| `height`           | INTEGER             | Высота холста                   |
| `background_color` | TEXT                | Цвет фона (например, `#FFFFFF`) |
| `current_color`    | TEXT                | Активный цвет кисти             |
| `created_at`       | TEXT                | Дата создания                   |
| `modified_at`      | TEXT                | Последнее изменение             |

#### **Таблица `layers`**

| Поле           | Тип                 | Описание                                           |
| -------------- | ------------------- | -------------------------------------------------- |
| `id`           | INTEGER PRIMARY KEY | ID слоя                                            |
| `project_id`   | INTEGER             | Ссылка на проект                                   |
| `name`         | TEXT                | Название слоя                                      |
| `type`         | TEXT                | Тип (`Solid`, `Image`, `Text`)                     |
| `visible`      | INTEGER             | 1 - видно, 0 - скрыто                              |
| `locked`       | INTEGER             | 1 - заблокировано                                  |
| `opacity`      | REAL                | Прозрачность слоя (0.0–1.0)                        |
| `z_value`      | INTEGER             | Порядок по оси Z                                   |
| `scale`        | REAL                | Масштаб                                            |
| `pixmap_path`  | TEXT                | Путь к изображению слоя (если `Image` или `Solid`) |
| `text_content` | TEXT                | Текст (если тип `Text`)                            |
| `text_color`   | TEXT                | Цвет текста (если тип `Text`)                      |
| `font_name`    | TEXT                | Название шрифта                                    |
| `font_size`    | INTEGER             | Размер шрифта                                      |

#### **Таблица `layer_image`**
_Специфична для Image-слоёв_

| Поле	        | Тип	                | Описание
| ------------- | ------------------- | ---------------------------------------------------------------------------------------- |
| `layer_id`    | INTEGER PRIMARY KEY |	ссылка на layers.id                                                                           |
| `pixmap_path`	| TEXT	              | Имя файла изображения в архиве (например, "layers/layer_3png")                           |

Вместо хранения бинарных данных в БД (что неэффективно), .png хранится в архиве, а путь относительно БД сохраняется в таблицу. Пример:

```
project.pld
├─ project.db
├─ layer_1.png
├─ layer_2.png
└─ layer_3.png
```

#### **Таблица `layer_solid`**
_Для сплошных слоёв (Solid)_

| Поле       | Тип                 | Описание |
| ---------- | ------------------- | -------- |
| `layer_id` | INTEGER PRIMARY KEY |          |
| `color_r`  | INTEGER             |          |
| `color_g`  | INTEGER             |          |
| `color_b`  | INTEGER             |          |

#### **Таблица `layer_text` **
_Для текстовых слоёв (Text)_

| Поле          | Тип                 | Описание  |
| ------------- | ------------------- | --------- |
| `layer_id`    | INTEGER PRIMARY KEY |           |
| `text`        | TEXT                | Сам текст |
| `font_family` | TEXT                |           |
| `font_size`   | INTEGER             |           |
| `color_r`     | INTEGER             |           |
| `color_g`     | INTEGER             |           |
| `color_b`     | INTEGER             |           |
